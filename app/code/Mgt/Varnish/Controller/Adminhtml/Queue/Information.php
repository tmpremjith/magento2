<?php
 namespace Mgt\Varnish\Controller\Adminhtml\Queue; class Information extends \Magento\Backend\App\Action { const SQL_LIMIT_URL_QUEUE = 500; protected $jsonHelper; protected $storeManager; protected $urlQueueCollection; public function __construct(\Magento\Backend\App\Action\Context $context, \Magento\Framework\Json\Helper\Data $jsonHelper, \Magento\Store\Model\StoreManagerInterface $storeManager, \Mgt\Varnish\Model\ResourceModel\UrlQueue\Collection $urlQueueCollection) { goto c911c; A08a5: $this->storeManager = $storeManager; goto E44f1; c911c: parent::__construct($context); goto d57cf; e9988: $this->urlQueueCollection = $urlQueueCollection; goto A08a5; d57cf: $this->jsonHelper = $jsonHelper; goto e9988; E44f1: } public function execute() { goto Cf962; De063: $urlsInQueue = $this->getUrlsFromQueue(); goto A9981; be20a: $response->representJson($this->jsonHelper->jsonEncode($data)); goto B4fe5; Cf962: $numberOfUrls = $this->urlQueueCollection->getSize(); goto De063; A9981: $data = ["\x6e\165\155\142\x65\162\117\146\x55\x72\x6c\163" => $numberOfUrls, "\x63\157\x6e\164\145\x6e\x74" => implode("\74\x62\x72\x3e", $urlsInQueue)]; goto e3e63; e3e63: $response = $this->getResponse(); goto be20a; B4fe5: return $response; goto Bd617; Bd617: } public function getUrlsFromQueue() { goto E2557; D7774: $this->urlQueueCollection->setPageSize(self::SQL_LIMIT_URL_QUEUE); goto dbbd5; dbbd5: $this->urlQueueCollection->load(); goto dc39a; dc39a: foreach ($this->urlQueueCollection as $url) { goto Eae99; Eae99: $storeId = $url->getStoreId(); goto a8215; A68af: $urls[] = $url; goto B5dce; a8215: $store = $this->storeManager->getStore($storeId); goto E1d45; B5dce: f664d: goto e0d4b; E1d45: $url = sprintf("\45\163\57\45\163", rtrim($store->getBaseUrl(), "\57"), ltrim($url->getPath(), "\57")); goto A68af; e0d4b: } goto b7f53; E2557: $urls = []; goto A5d32; A5d32: $this->urlQueueCollection->addOrder("\160\162\x69\157\x72\151\x74\x79"); goto D7774; b7f53: a3141: goto Fcea5; Fcea5: return $urls; goto C4ac5; C4ac5: } }
