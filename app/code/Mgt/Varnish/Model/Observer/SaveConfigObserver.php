<?php
 namespace Mgt\Varnish\Model\Observer; use Magento\Framework\Event\ObserverInterface; use Magento\Framework\Event\Observer; class SaveConfigObserver implements ObserverInterface { const FULL_PAGE_CACHE_STATUS_ENABLED = 1; const FULL_PAGE_CACHE_STATUS_DISABLED = 0; protected $config; protected $deploymentConfigWriter; protected $configValueFactory; protected $cachePurger; protected $cacheTypeList; public function __construct(\Mgt\Varnish\Model\Cache\Config $config, \Magento\Framework\App\DeploymentConfig\Writer $deploymentConfigWriter, \Magento\Framework\App\Config\ValueFactory $configValueFactory, \Magento\CacheInvalidate\Model\PurgeCache $cachePurger, \Magento\Framework\App\Cache\TypeListInterface $cacheTypeList) { goto b22fd; fdf11: $this->deploymentConfigWriter = $deploymentConfigWriter; goto b6697; b6697: $this->configValueFactory = $configValueFactory; goto Dd8f3; Dd8f3: $this->cachePurger = $cachePurger; goto d78bb; b22fd: $this->config = $config; goto fdf11; d78bb: $this->cacheTypeList = $cacheTypeList; goto c7059; c7059: } public function execute(Observer $observer) { $isVarnishEnabled = $this->config->isEnabled(); try { goto a4e1d; E6057: foreach ($cacheTypes as $cacheTypeKey => $cacheType) { $appEnvDataCacheTypes["\141\160\160\x5f\x65\156\166"]["\143\141\143\150\145\137\164\171\160\145\x73"][$cacheTypeKey] = (int) $cacheType->getStatus(); e2325: } goto D2cb9; bbe4f: b00c1: goto e2e24; b61d9: if (!$cacheTypes) { goto b00c1; } goto E6057; b2afe: if (!isset($cacheTypes["\x66\165\154\154\137\x70\141\147\145"])) { goto E0429; } goto E26c4; e2e24: $this->deploymentConfigWriter->saveConfig($appEnvDataCacheTypes, true); goto e28dd; b2ff6: if (true === $isVarnishEnabled) { goto Fc769; } goto bad70; f3f25: goto e9744; goto f2862; f2862: Fc769: goto c625c; c74bf: $configValue->save(); goto b2afe; a4e1d: $configValue = $this->configValueFactory->create(); goto f0ffc; bae21: $appEnvDataCacheTypes = []; goto b61d9; E26c4: $cacheTypes["\146\x75\x6c\x6c\x5f\160\x61\147\145"]->setStatus(self::FULL_PAGE_CACHE_STATUS_ENABLED); goto B05aa; d759e: if (!isset($cacheTypes["\146\x75\x6c\154\137\160\141\x67\145"])) { goto ad935; } goto f750d; d2d81: $configValue->delete(); goto F0d9b; B2f60: $cacheTypes = $this->cacheTypeList->getTypes(); goto b2ff6; f750d: $cacheTypes["\146\165\154\154\x5f\160\x61\147\145"]->setStatus(self::FULL_PAGE_CACHE_STATUS_DISABLED); goto Ed07e; D2cb9: d0284: goto bbe4f; Aaf0b: $this->cachePurger->sendPurgeRequest("\x2a"); goto f3f25; B05aa: E0429: goto Ba54a; f0ffc: $configValue->load(\Magento\PageCache\Model\Config::XML_PAGECACHE_TYPE, "\x70\x61\x74\150"); goto B2f60; F0d9b: e3f8d: goto d759e; c625c: $configValue->setPath(\Magento\PageCache\Model\Config::XML_PAGECACHE_TYPE); goto B9ca0; Ba54a: e9744: goto bae21; bad70: if (!$configValue->getId()) { goto e3f8d; } goto d2d81; Ed07e: ad935: goto Aaf0b; B9ca0: $configValue->setValue(\Magento\PageCache\Model\Config::VARNISH); goto c74bf; e28dd: } catch (\Exception $e) { throw new $e(); } } }
